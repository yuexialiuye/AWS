# 第十一周
# S3(Simple Storage Service)--Buckets
* 儲存檔案的地方
* 全球性
* 儲存桶名字是全球唯一的
# Buckets權限
* bucket policy
   * 以桶子為中心，設定某人可以進行什麼操作
* IAM
   * 針對某人設定權限，主體為人
* ACL(Access Control List)
# 使用Buckets功能
> 建立Buckets
```sh
切換到S3頁面
Buckets
Create bucket
Bucket name: tests3-lily
AWS Region : US East (N. Virginia) us-east-1
Block Public Access settings for this bucket勾選Block all public access
Bucket Versioning勾選Disable
Create bucket
```

> 查看已上傳檔案
```sh
點進剛剛創建的tests3-lily
Upload
上傳創建的1.txt及2.png檔案
Upload
點進1.txt
可點擊上方Open查看，
```

> 讓檔案公開存取
```sh
點進tests3-lily存取桶
Permissions
Block public access (bucket settings) Edit
取消所有打勾
Save
Permissions
Bucket policy
Edit

{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "PublicReadGetObject",
            "Effect": "Allow",
            "Principal": "*",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::blog.smallko.online/*"
        }
    ]
}

把arn:aws:s3:::blog.smallko.online改成自己上方的Bucket ARN
Save changes
此時已經可以用網址打開檔案
```
<img src="../pic/1128.png">

> 刪除Bucket
```sh
點選tests3-lily，Empty
輸入permanently delete
Empty
點選tests3-lily
Delete
輸入tests3-lily
Delete
刪除成功
```

> 查看檔案歷史更新
```sh
創建bucket
Create bucket
Bucket name: s3-lily
AWS Region : US East (N. Virginia) us-east-1
Block Public Access settings for this bucket勾選Block all public access
Bucket Versioning勾選Enable
Create bucket
打開1.txt檔，把裡面內容改為111
上傳s3-lily Bucket
打開1.txt檔，把裡面內容改為222
上傳s3-lily Bucket
打開1.txt檔，把裡面內容改為333
上傳s3-lily Bucket
點進s3-lily
打開Show versions
能看到剛剛上傳的3個版本
```

# 跨不同區域進行同步備份
> 創建2個Bucket
```sh
Create bucket
Bucket name: source-lily 、 target-lily
AWS Region : US East (N. Virginia) us-east-1 、 Asia Pacific (Tokyo) ap-northeast-1
Block Public Access settings for this bucket勾選Block all public access
Bucket Versioning勾選Enable
```

>連結2個bucket
```sh
點進source-lily
Management
Replication rules
Create replication rule
Replication rule name : S3CopyRule
Source bucket勾選Apply to all objects in the bucket
Destination
Bucket name
Browse S3選擇target-lily
IAM role選擇Choose from existing IAM roles
Save
選擇No,do not replicate existing object.
Submit
```

> 同步備份
```sh
點進source-lily
上傳3個檔案
等2分鐘
到target-lily東西是否同步
```
<img src="../pic/1128-1.png">
