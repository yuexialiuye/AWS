# 第四周
# 複習架構
* 創建一個虛擬雲端中心，裡面有公開網路及私有網路
* 為了讓公開網路能與外界網路連接，需要安裝IGW，設定路由表綁定

# 這周做的事
* 讓虛擬機直接擁有一個public ip
* 創造另一台虛擬機，使公開網路及私有網路的虛擬機互相交流
* 在私有網路的虛擬機創建資料庫
* mariadb透過NATGW、IGW連到網際網路

# 顯示Public ip
VPC <br>↓<br>
Subnets <br>↓<br>
testvpc-public打勾<br>↓<br>
Edit subnet setting<br>↓<br>
勾選 Enable auto-assign public IPv4 address<br>↓<br>
Save<br>
Auto-assign public IPv4 address應顯示YES

# 建立資料庫虛擬機(內網)
開機上禮拜的Ec2網頁虛擬機<br>↓<br>
新建另一台用來裝資料庫的虛擬機(網路是私有網路，不要公有網路)<br>↓<br>
新增MYSQL/AURORA規則<br>↓<br>
創建

# 打開公有及私有網路虛擬機

## 利用VMware連接公有網路vpc
ssh -i testkey.pem ec2-user@(網頁的Public IPv4 address ip)

## 利用VMware連接私有網路vpc
另開一終端機<br>↓<br>
scp -i ./testkey.pem testkey.pem ec2-user@(網頁的Public IPv4 address ip):/home/ec2-user testkey.pem<br>↓<br>
ssh -i testkey.pem ec2-user@(網頁的Public IPv4 address ip)<br>↓<br>
ssh -i testkey.pem ec2-user@(資料庫的Private IPv4 address ip)<br>↓<br>
成功連接
 <img src="../pic/1003.png">

 # 使DB虛擬機能聯外網
 
 * 創建NATgw<br>
 到VPC上<br>↓<br>
 NAT gateways<br>↓<br>
 Create NAT gateway<br>↓<br>
 取名 natgw-testvpc<br>↓<br>
 Subnet選擇(testvpc-public)<br>↓<br>
 Connectivity type選擇Public<br>↓<br>
 Elastic IPallocation ID 直接按旁邊的Allocate Elastic IP<br>↓<br>
 Create NAT gateway<br>↓<br>
 創建完成<br>
 
 * 創建內定路由表<br>
 Route tables <br>↓<br>
 Create route tables <br>↓<br>
 取名rt-testvpc-private <br>↓<br>
 VPC選擇(testvpc) <br>↓<br>
 Create route tables <br>↓<br>
 選擇rt-testvpc-private <br>↓<br>
 Edit routes <br>↓<br>
 Add route<br>↓<br>
 Target選擇NAT gateway<br>↓<br>
 選擇剛才創建的natgw-testvpc <br>↓<br>
 Save changes<br>↓<br>
 創建完成<br>

 *套用路由表
 Route tables<br>↓<br>
 勾選rt-testvpc-private <br>↓<br>
 Subnet associations <br>↓<br>
 Edit subnet associations<br>↓<br> 
 打勾testvpc-private <br>↓<br>
 Save associations<br>↓<br>
 回到DB虛擬機上<br>↓<br>
 ping 8.8.8.8<br>↓<br>
 成功連接外網
 <img src="../pic/1003-1.png">
